{"version":3,"file":"MenuBody.js","sources":["../../../../src/components/Menu/MenuBody/MenuBody.tsx"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\nimport cx from 'clsx';\nimport { useFocusTrap } from '@mantine/hooks';\nimport { DefaultProps, MantineNumberSize, mergeStyles, useMantineTheme } from '../../../theme';\nimport { MantineTransition } from '../../Transition/Transition';\nimport { Paper } from '../../Paper/Paper';\nimport { Divider } from '../../Divider/Divider';\nimport { Text } from '../../Text/Text';\nimport { MenuItem, MenuItemType } from '../MenuItem/MenuItem';\nimport { MenuLabel } from '../MenuLabel/MenuLabel';\nimport { MenuButton, MenuButtonStylesNames } from '../MenuButton/MenuButton';\nimport useStyles from './MenuBody.styles';\n\nexport type MenuBodyStylesNames = keyof ReturnType<typeof useStyles> | MenuButtonStylesNames;\n\nexport interface MenuBodyProps\n  extends DefaultProps<MenuBodyStylesNames>,\n    React.ComponentPropsWithoutRef<'div'> {\n  /** When true menu is mounted to the dom */\n  opened: boolean;\n\n  /** Triggers when menu is closed */\n  onClose(): void;\n\n  /** <MenuItem /> and <Divider /> components only */\n  children: React.ReactNode;\n\n  /** Transition styles */\n  transition?: MantineTransition;\n\n  /** Transitions duration in ms */\n  transitionDuration?: number;\n\n  /** Transition timing function */\n  transitionTimingFunction?: string;\n\n  /** Predefined menu width or number for width in px */\n  size?: MantineNumberSize;\n\n  /** Predefined shadow from theme or box-shadow value */\n  shadow?: string;\n\n  /** Should menu close on outside click */\n  closeOnClickOutside?: boolean;\n\n  /** Should menu close on item click */\n  closeOnItemClick?: boolean;\n\n  /** Body border-radius */\n  radius?: MantineNumberSize;\n\n  /** Trap focus inside menu */\n  trapFocus?: boolean;\n}\n\nfunction getNextItem(active: number, items: MenuItemType[]) {\n  for (let i = active + 1; i < items.length; i += 1) {\n    if (!items[i].props.disabled && items[i].type === MenuItem) {\n      return i;\n    }\n  }\n\n  return active;\n}\n\nfunction findInitialItem(items: MenuItemType[]) {\n  for (let i = 0; i < items.length; i += 1) {\n    if (!items[i].props.disabled && items[i].type === MenuItem) {\n      return i;\n    }\n  }\n\n  return -1;\n}\n\nfunction getPreviousItem(active: number, items: MenuItemType[]) {\n  for (let i = active - 1; i >= 0; i -= 1) {\n    if (!items[i].props.disabled && items[i].type === MenuItem) {\n      return i;\n    }\n  }\n\n  if (!items[active] || items[active].type !== MenuItem) {\n    return findInitialItem(items);\n  }\n\n  return active;\n}\n\nexport function MenuBody({\n  className,\n  style,\n  themeOverride,\n  opened,\n  onClose,\n  children,\n  size = 'md',\n  shadow = 'md',\n  closeOnItemClick = true,\n  transitionDuration = 150,\n  classNames,\n  styles,\n  radius,\n  trapFocus = true,\n  ...others\n}: MenuBodyProps) {\n  const items = React.Children.toArray(children).filter(\n    (item: MenuItemType) =>\n      item.type === MenuItem || item.type === Divider || item.type === MenuLabel\n  ) as MenuItemType[];\n\n  const hoveredTimeout = useRef<number>();\n  const buttonsRefs = useRef<Record<string, HTMLButtonElement>>({});\n  const theme = useMantineTheme(themeOverride);\n  const classes = useStyles({ size, theme }, classNames, 'menu');\n  const _styles = mergeStyles(classes, styles);\n  const [hovered, setHovered] = useState(findInitialItem(items));\n  const focusTrapRef = useFocusTrap(trapFocus);\n\n  useEffect(() => {\n    if (!opened) {\n      hoveredTimeout.current = window.setTimeout(() => {\n        setHovered(findInitialItem(items));\n      }, transitionDuration);\n    } else {\n      window.clearTimeout(hoveredTimeout.current);\n    }\n\n    return () => window.clearTimeout(hoveredTimeout.current);\n  }, [opened]);\n\n  const handleKeyDown = (event: React.KeyboardEvent<HTMLDivElement>) => {\n    const { code } = event.nativeEvent;\n\n    if (code === 'Escape') {\n      onClose();\n    }\n\n    if (code === 'Tab' && trapFocus) {\n      event.preventDefault();\n    }\n\n    if (code === 'ArrowUp') {\n      event.preventDefault();\n      const prevIndex = getPreviousItem(hovered, items);\n      setHovered(prevIndex);\n      buttonsRefs.current[prevIndex].focus();\n    }\n\n    if (code === 'ArrowDown') {\n      event.preventDefault();\n      const nextIndex = getNextItem(hovered, items);\n      setHovered(nextIndex);\n      buttonsRefs.current[nextIndex].focus();\n    }\n  };\n\n  if (items.length === 0) {\n    return null;\n  }\n\n  const buttons = items.map((item, index) => {\n    if (item.type === MenuItem) {\n      return (\n        <MenuButton<'button'>\n          {...item.props}\n          key={index}\n          hovered={hovered === index}\n          onHover={() => setHovered(index)}\n          radius={radius}\n          classNames={classNames}\n          styles={styles}\n          onClick={(event) => {\n            if (closeOnItemClick) {\n              onClose();\n            }\n\n            if (typeof item.props.onClick === 'function') {\n              item.props.onClick(event);\n            }\n          }}\n          elementRef={(node) => {\n            buttonsRefs.current[index] = node;\n          }}\n        />\n      );\n    }\n\n    if (item.type === MenuLabel) {\n      return (\n        <Text\n          key={index}\n          className={classes.label}\n          style={_styles.label}\n          {...(item.props as any)}\n        />\n      );\n    }\n\n    if (item.type === Divider) {\n      return (\n        <Divider\n          variant=\"solid\"\n          className={classes.divider}\n          margins={theme.spacing.xs / 2}\n          style={_styles.divider}\n          key={index}\n        />\n      );\n    }\n\n    return null;\n  });\n\n  return (\n    <Paper\n      shadow={shadow}\n      className={cx(classes.body, className)}\n      style={{ ...style, ..._styles.body }}\n      onKeyDownCapture={handleKeyDown}\n      role=\"menu\"\n      aria-orientation=\"vertical\"\n      radius={radius}\n      onMouseLeave={() => setHovered(-1)}\n      {...others}\n    >\n      <div ref={focusTrapRef}>{buttons}</div>\n    </Paper>\n  );\n}\n\nMenuBody.displayName = '@mantine/core/MenuBody';\n"],"names":["MenuItem","React","Divider","MenuLabel","useRef","useMantineTheme","useStyles","mergeStyles","useState","useFocusTrap","useEffect","MenuButton","Text","Paper","cx"],"mappings":"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"}